# üîß –ó–í–Ü–¢: –í–ò–õ–£–ß–ï–ù–ù–Ø –ö–ù–û–ü–ö–ò –†–ï–î–ê–ì–£–í–ê–ù–ù–Ø –ó –ë–ê–ù–ö–Ü–í–°–¨–ö–ò–• –í–ò–ü–ò–°–û–ö

## üìã –ó–ê–í–î–ê–ù–ù–Ø

–ü—Ä–∏–±—Ä–∞—Ç–∏ –∫–Ω–æ–ø–∫—É —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ø—ñ—Å–ª—è —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ –≤–∏–ø–∏—Å–æ–∫ –∑:

- ‚úÖ Excel –≤–∏–ø–∏—Å–∫–∏ –∑ –ü—Ä–∏–≤–∞—Ç–ë–∞–Ω–∫—É
- ‚úÖ CSV –≤–∏–ø–∏—Å–∫–∏ –∑ –ú–æ–Ω–æ–ë–∞–Ω–∫—É
- ‚úÖ Excel –≤–∏–ø–∏—Å–∫–∏ –∑ –ú–æ–Ω–æ–ë–∞–Ω–∫—É
- ‚úÖ PDF –≤–∏–ø–∏—Å–∫–∏ –∑ –ú–æ–Ω–æ–ë–∞–Ω–∫—É

## üéØ –í–ò–ö–û–ù–ê–ù–Ü –ó–ú–Ü–ù–ò

### 1. –ú–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Ñ—É–Ω–∫—Ü—ñ—ó `show_transactions_preview`

**–§–∞–π–ª**: `handlers/message_handler.py`

**–ó–º—ñ–Ω–∏**:

- –î–æ–¥–∞–Ω–æ –ª–æ–≥—ñ–∫—É –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç–∏–ø—É —Ñ–∞–π–ª—É (`file_source` —Ç–∞ `awaiting_file`)
- –î–ª—è —Ñ–∞–π–ª—ñ–≤ –±–∞–Ω–∫—ñ–≤ (`privatbank`, `monobank`) –∞–±–æ —Ñ–∞–π–ª—ñ–≤ —Ç–∏–ø—É `excel`, `csv`, `pdf` –∫–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ø—Ä–∏—Ö–æ–≤—É—î—Ç—å—Å—è
- –ê–¥–∞–ø—Ç–æ–≤–∞–Ω–æ —Ç–µ–∫—Å—Ç —Ç–∞ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä—É –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –ø–æ–∫–∞–∑—É –∫–Ω–æ–ø–∫–∏

**–î–æ**:

```python
keyboard = [
    [
        InlineKeyboardButton("‚úÖ –î–æ–¥–∞—Ç–∏ –≤—Å—ñ", callback_data="import_all_transactions"),
        InlineKeyboardButton("‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏", callback_data="edit_transactions")
    ],
    [
        InlineKeyboardButton("‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏", callback_data="cancel_import")
    ]
]
```

**–ü—ñ—Å–ª—è**:

```python
# –õ–æ–≥—ñ–∫–∞ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –∫–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
file_source = context.user_data.get('file_source', 'unknown')
awaiting_file_type = context.user_data.get('awaiting_file', 'unknown')

show_edit_button = True
if file_source in ['privatbank', 'monobank'] or awaiting_file_type in ['excel', 'csv', 'pdf']:
    show_edit_button = False

# –ê–¥–∞–ø—Ç–∏–≤–Ω–∞ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∞
if show_edit_button:
    keyboard = [
        [
            InlineKeyboardButton("‚úÖ –î–æ–¥–∞—Ç–∏ –≤—Å—ñ", callback_data="import_all_transactions"),
            InlineKeyboardButton("‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏", callback_data="edit_transactions")
        ],
        [
            InlineKeyboardButton("‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏", callback_data="cancel_import")
        ]
    ]
else:
    keyboard = [
        [
            InlineKeyboardButton("‚úÖ –î–æ–¥–∞—Ç–∏ –≤—Å—ñ", callback_data="import_all_transactions")
        ],
        [
            InlineKeyboardButton("‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏", callback_data="cancel_import")
        ]
    ]
```

### 2. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è `file_source` –¥–ª—è –ü—Ä–∏–≤–∞—Ç–ë–∞–Ω–∫—É

**–§–∞–π–ª**: `handlers/transaction_handler.py`

**–§—É–Ω–∫—Ü—ñ—è**: `show_privatbank_excel_guide`

```python
async def show_privatbank_excel_guide(query, context):
    """–ü–æ–∫–∞–∑—É—î –¥–µ—Ç–∞–ª—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤–∏–ø–∏—Å–∫–∏ –∑ –ü—Ä–∏–≤–∞—Ç–±–∞–Ω–∫—É"""
    # –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –¥–∂–µ—Ä–µ–ª–æ —Ñ–∞–π–ª—É
    context.user_data['file_source'] = 'privatbank'
    # ...—Ä–µ—à—Ç–∞ –∫–æ–¥—É
```

### 3. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è `file_source` –¥–ª—è –ú–æ–Ω–æ–ë–∞–Ω–∫—É

**–§–∞–π–ª**: `handlers/transaction_handler.py`

**–§—É–Ω–∫—Ü—ñ—è**: `show_monobank_excel_guide`

```python
async def show_monobank_excel_guide(query, context):
    """–°—É—á–∞—Å–Ω–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Excel –≤–∏–ø–∏—Å–∫–∏ Monobank –∑ —á—ñ—Ç–∫–∏–º –æ–ø–∏—Å–æ–º –∫–Ω–æ–ø–∫–∏."""
    # –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –¥–∂–µ—Ä–µ–ª–æ —Ñ–∞–π–ª—É
    context.user_data['file_source'] = 'monobank'
    # ...—Ä–µ—à—Ç–∞ –∫–æ–¥—É
```

**–§–∞–π–ª**: `handlers/callback_handler.py`

**–û–±—Ä–æ–±–Ω–∏–∫–∏ callback'—ñ–≤**:

```python
elif callback_data == "monobank_csv_guide":
    context.user_data['file_source'] = 'monobank'
    await show_upload_csv_guide(query, context)
elif callback_data == "monobank_pdf_guide":
    context.user_data['file_source'] = 'monobank'
    await show_monobank_pdf_guide(query, context)
elif callback_data == "monobank_excel_guide":
    context.user_data['file_source'] = 'monobank'
    await show_monobank_excel_guide(query, context)
```

## üß™ –¢–ï–°–¢–£–í–ê–ù–ù–Ø

### –°—Ç–≤–æ—Ä–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤—ñ —Å–∫—Ä–∏–ø—Ç–∏:

1. **`test_hide_edit_button.py`** - –±–∞–∑–æ–≤–∏–π —Ç–µ—Å—Ç –ª–æ–≥—ñ–∫–∏ –ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –∫–Ω–æ–ø–∫–∏
2. **`test_real_workflow.py`** - —Ç–µ—Å—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤–æ—Ä–∫—Ñ–ª–æ–≤—É –∑ —Å–∏–º—É–ª—è—Ü—ñ—î—é –¥—ñ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

### –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è:

‚úÖ **–¢–µ—Å—Ç 1**: –ó–≤–∏—á–∞–π–Ω–∏–π —Ñ–∞–π–ª - –∫–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è **–ø–æ–∫–∞–∑—É—î—Ç—å—Å—è**  
‚úÖ **–¢–µ—Å—Ç 2**: Excel –ü—Ä–∏–≤–∞—Ç–ë–∞–Ω–∫ - –∫–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è **–ø—Ä–∏—Ö–æ–≤—É—î—Ç—å—Å—è**  
‚úÖ **–¢–µ—Å—Ç 3**: CSV –ú–æ–Ω–æ–ë–∞–Ω–∫ - –∫–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è **–ø—Ä–∏—Ö–æ–≤—É—î—Ç—å—Å—è**  
‚úÖ **–¢–µ—Å—Ç 4**: PDF –ú–æ–Ω–æ–ë–∞–Ω–∫ - –∫–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è **–ø—Ä–∏—Ö–æ–≤—É—î—Ç—å—Å—è**  
‚úÖ **–¢–µ—Å—Ç 5**: Excel –ú–æ–Ω–æ–ë–∞–Ω–∫ - –∫–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è **–ø—Ä–∏—Ö–æ–≤—É—î—Ç—å—Å—è**

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢

### –î–æ –∑–º—ñ–Ω:

–ü—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –±—É–¥—å-—è–∫–æ–≥–æ —Ñ–∞–π–ª—É –≤–∏–ø–∏—Å–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏–≤ 2 –∫–Ω–æ–ø–∫–∏:

- "‚úÖ –î–æ–¥–∞—Ç–∏ –≤—Å—ñ"
- "‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏"

### –ü—ñ—Å–ª—è –∑–º—ñ–Ω:

**–î–ª—è –±–∞–Ω–∫—ñ–≤—Å—å–∫–∏—Ö —Ñ–∞–π–ª—ñ–≤** (–ü—Ä–∏–≤–∞—Ç–ë–∞–Ω–∫, –ú–æ–Ω–æ–ë–∞–Ω–∫):

- "‚úÖ –î–æ–¥–∞—Ç–∏ –≤—Å—ñ"
- "‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏"

**–î–ª—è —ñ–Ω—à–∏—Ö —Ñ–∞–π–ª—ñ–≤**:

- "‚úÖ –î–æ–¥–∞—Ç–∏ –≤—Å—ñ"
- "‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏"
- "‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏"

## üîç –õ–û–ì–Ü–ö–ê –í–ò–ó–ù–ê–ß–ï–ù–ù–Ø

–ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è **–ø—Ä–∏—Ö–æ–≤—É—î—Ç—å—Å—è**, —è–∫—â–æ:

- `file_source` = `'privatbank'` –∞–±–æ `'monobank'`
- **–ê–ë–û** `awaiting_file` = `'excel'`, `'csv'` –∞–±–æ `'pdf'`

–ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è **–ø–æ–∫–∞–∑—É—î—Ç—å—Å—è** –¥–ª—è –≤—Å—ñ—Ö —ñ–Ω—à–∏—Ö –≤–∏–ø–∞–¥–∫—ñ–≤.

## ‚úÖ –ü–ï–†–ï–í–Ü–†–ö–ê –ó–ê–í–î–ê–ù–ù–Ø

| –¢–∏–ø —Ñ–∞–π–ª—É                   | –ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è | –°—Ç–∞—Ç—É—Å      |
| --------------------------- | ------------------ | ----------- |
| Excel –≤–∏–ø–∏—Å–∫–∞ –∑ –ü—Ä–∏–≤–∞—Ç–ë–∞–Ω–∫—É | ‚ùå –ü—Ä–∏—Ö–æ–≤–∞–Ω–æ       | ‚úÖ –í–∏–∫–æ–Ω–∞–Ω–æ |
| CSV –≤–∏–ø–∏—Å–∫–∞ –∑ –ú–æ–Ω–æ–ë–∞–Ω–∫—É     | ‚ùå –ü—Ä–∏—Ö–æ–≤–∞–Ω–æ       | ‚úÖ –í–∏–∫–æ–Ω–∞–Ω–æ |
| Excel –≤–∏–ø–∏—Å–∫–∞ –∑ –ú–æ–Ω–æ–ë–∞–Ω–∫—É   | ‚ùå –ü—Ä–∏—Ö–æ–≤–∞–Ω–æ       | ‚úÖ –í–∏–∫–æ–Ω–∞–Ω–æ |
| PDF –≤–∏–ø–∏—Å–∫–∞ –∑ –ú–æ–Ω–æ–ë–∞–Ω–∫—É     | ‚ùå –ü—Ä–∏—Ö–æ–≤–∞–Ω–æ       | ‚úÖ –í–∏–∫–æ–Ω–∞–Ω–æ |
| –Ü–Ω—à—ñ —Ñ–∞–π–ª–∏                  | ‚úÖ –ü–æ–∫–∞–∑—É—î—Ç—å—Å—è     | ‚úÖ –í–∏–∫–æ–Ω–∞–Ω–æ |

## üöÄ –ì–û–¢–û–í–ù–Ü–°–¢–¨

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–û**

–í—Å—ñ –∑–º—ñ–Ω–∏ –ø—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω—ñ —Ç–∞ –≥–æ—Ç–æ–≤—ñ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è. –ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–µ–ø–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏—Ö–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —Ñ–∞–π–ª—ñ–≤ –±–∞–Ω–∫—ñ–≤—Å—å–∫–∏—Ö –≤–∏–ø–∏—Å–æ–∫, —â–æ –ø–æ–∫—Ä–∞—â—É—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏–π –¥–æ—Å–≤—ñ–¥ —Ç–∞ –∑–º–µ–Ω—à—É—î –ø–ª—É—Ç–∞–Ω–∏–Ω—É –ø—Ä–∏ —ñ–º–ø–æ—Ä—Ç—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –∑ –±–∞–Ω–∫—ñ–≤.
