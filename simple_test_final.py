#!/usr/bin/env python3
"""
–ü—Ä–æ—Å—Ç–∏–π —Ç–µ—Å—Ç –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ñ—ñ–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
"""

import sys
import os
import logging

# –î–æ–¥–∞—î–º–æ –ø–æ—Ç–æ—á–Ω—É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –¥–æ —à–ª—è—Ö—É
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from services.receipt_processor_enhanced import EnhancedReceiptProcessor

def simple_test():
    """–ü—Ä–æ—Å—Ç–∏–π —Ç–µ—Å—Ç –∑ –ø—Ä—è–º–∏–º –≤–∏–∫–ª–∏–∫–æ–º –º–µ—Ç–æ–¥—É"""
    
    processor = EnhancedReceiptProcessor()
    
    print("=== –ü–†–û–°–¢–ò–ô –¢–ï–°–¢ –ü–ê–†–°–ò–ù–ì–£ ===")
    
    # –û—á–∏—â–µ–Ω–∏–π —Ç–µ–∫—Å—Ç –ø—ñ—Å–ª—è –≤—Å—ñ—Ö OCR –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å
    cleaned_text = """–§–û–ü –õ–Ü–û–¢–Ü–ö–û–í –í–Ü–¢–ê–õ–Ü–ô –í–ê–õ–ï–†–Ü–á–û–í–ò–ß
–ú–∞–≥–∞–∑–∏–Ω
–ú–∏–∫–æ–ª–∞—ó–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å, M. –ú–∏–∫–æ–ª–∞—ó–≤, –ó–∞–≤–æ–¥—Å—å–∫–∏–π —Ä–∞–π–æ–Ω, Byn
–õ–∞–∑—É—Ä–Ω–∞, –±—É–¥16–≤
Tf] 2903314199
–ö–∞—Å–æ–≤–∏–π —á–µ–∫
–ü–†–†–û OH 4000962466 –í–ù 1
–ß–ï–ö OH _5eAP3VrxXi8 –í–ù 288 onnaitn
–Ω–æ–º–µ—Ä –î–õ–Ø –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:
(66) 086 22 81
098714014460
–ü—ñ–¥–ø–∏—Å ne –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω
APT... 271558 17871/w1/–í/–í–æ–¥–∞ —Å–æ–ª–æ–¥ Sprite 3/6 0.33n
1.000 x 24.30 = 24.30
APT. Me 271559 3838/¬´r/–í/–¶—É–∫–∞—Ç–∏ –∞–Ω–∞–Ω–∞—Å –∫—ñ–ª—å—Ü–µ Bar /MM/
@.186 x 409.50 = 76.17
–°–£–ú–ê –î–û –°–ü–õ–ê–¢–ò: 100.47
–ë–ï–ó–ì–û–¢–Ü–í–ö–û–í–ê. –ë–ï–ó–ì–û–¢–Ü–í–ö–û–í–ò–ô: 100.47
Bes NDB
–î—è–∫—É—î–º–æ!
Mu –≤—ñ–¥–∫—Ä–∏–ª–∏—Å—å!!!
–Ü–Ω—Ç–µ—Ä–Ω–µ—Ç‚Äî–º–∞–≥–∞–∑–∏–Ω "MIDA"
mid
a.mk.ua
---Onnata Ef3--------‚Äî-
–ï–∫–≤–∞–π—Ä: –ü—Ä–∏–≤–∞—Ç–±–∞–Ω–∫
–¢–æ—Ä–≥–æ–≤–µ—Ü—å: S
1NFQ7HN
–¢–µ—Ä–º—ñ–Ω–∞–ª: SINFQ7HN
–ü–ª–∞—Ç—ñ–∂–Ω–∞ —Å–∏—Å—Ç–µ–º–∞: MasterCar
d
EM3: XXXXXXXXXXXX2210
Koy –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó: 717989
RRN:
18-06-2025 13:47:15
–§–Ü–°–ö–ê–õ–¨–ù–ò–ô –ß–ï–ö
–§–Ü–°–ö–û –ß–ï–ö
–î–µ—Ä–∂–∞–≤–Ω–∞ nopatkosa —Å–ª—É–∂–±–∞ YKpainn"""

    # –ü—Ä—è–º–∏–π –≤–∏–∫–ª–∏–∫ –ø–∞—Ä—Å–µ—Ä–∞
    result = processor._parse_receipt_text(cleaned_text)
    
    print("=== –§–Ü–ù–ê–õ–¨–ù–ò–ô –†–ï–ó–£–õ–¨–¢–ê–¢ ===")
    print(f"üìÖ –î–∞—Ç–∞: {result.get('date')}")
    print(f"üè™ –ú–∞–≥–∞–∑–∏–Ω: {result.get('store_name')}")
    print(f"üí∞ –ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞: {result.get('total_amount')}")
    print(f"üõí –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–æ–≤–∞—Ä—ñ–≤: {result.get('items_count')}")
    
    items = result.get('items', [])
    if items:
        print("\n--- –¢–û–í–ê–†–ò ---")
        for i, item in enumerate(items, 1):
            print(f"{i}. {item.get('name', '–ù–µ–≤—ñ–¥–æ–º–æ')}")
            print(f"   –¶—ñ–Ω–∞: {item.get('price', 0)}")
            print(f"   –ö—ñ–ª—å–∫—ñ—Å—Ç—å: {item.get('quantity', 1)}")
            print(f"   –ö–∞—Ç–µ–≥–æ—Ä—ñ—è: {item.get('category', '–ù–µ–≤—ñ–¥–æ–º–æ')}")
            print()

if __name__ == "__main__":
    simple_test()
