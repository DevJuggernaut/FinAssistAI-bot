import logging
from database.models import init_db, Category, Session

logger = logging.getLogger(__name__)
session = Session()

def setup_database():
    """
    –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ —Å–æ–∑–¥–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã
    """
    try:
        logger.info("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...")
        init_db()
        logger.info("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞")
        return True
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: {e}")
        return False

def create_default_categories():
    """
    –°–æ–∑–¥–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    """
    try:
        default_categories = [
            # –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤
            ("üè† –ñ–∏–ª—å–µ", "expense", "–ê—Ä–µ–Ω–¥–∞, –∫–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏, —Ä–µ–º–æ–Ω—Ç"),
            ("üçΩÔ∏è –ü–∏—Ç–∞–Ω–∏–µ", "expense", "–ü—Ä–æ–¥—É–∫—Ç—ã, —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã, –∫–∞—Ñ–µ"),
            ("üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç", "expense", "–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, —Ç–∞–∫—Å–∏, —Ç–æ–ø–ª–∏–≤–æ"),
            ("üëï –û–¥–µ–∂–¥–∞", "expense", "–û–¥–µ–∂–¥–∞, –æ–±—É–≤—å, –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã"),
            ("üíä –ó–¥–æ—Ä–æ–≤—å–µ", "expense", "–õ–µ–∫–∞—Ä—Å—Ç–≤–∞, –≤—Ä–∞—á–∏, —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞"),
            ("üì± –°–≤—è–∑—å", "expense", "–¢–µ–ª–µ—Ñ–æ–Ω, –∏–Ω—Ç–µ—Ä–Ω–µ—Ç, –¢–í"),
            ("üéì –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ", "expense", "–ö—É—Ä—Å—ã, –∫–Ω–∏–≥–∏, —Ç—Ä–µ–Ω–∏–Ω–≥–∏"),
            ("üé≠ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è", "expense", "–ö–∏–Ω–æ, –∫–æ–Ω—Ü–µ—Ä—Ç—ã, —Ö–æ–±–±–∏"),
            ("üí∞ –°–±–µ—Ä–µ–∂–µ–Ω–∏—è", "expense", "–ù–∞–∫–æ–ø–ª–µ–Ω–∏—è, –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏"),
            ("üéÅ –ü–æ–¥–∞—Ä–∫–∏", "expense", "–ü–æ–¥–∞—Ä–∫–∏, –±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å"),
            ("üíº –†–∞–±–æ—Ç–∞", "expense", "–†–∞–±–æ—á–∏–µ —Ä–∞—Å—Ö–æ–¥—ã, –æ—Ñ–∏—Å–Ω—ã–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏"),
            ("üè• –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ", "expense", "–í—Å–µ –≤–∏–¥—ã —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è"),
            ("üì¶ –ü–æ–∫—É–ø–∫–∏", "expense", "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞, –±—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞"),
            ("üîÑ –†–µ–≥—É–ª—è—Ä–Ω—ã–µ", "expense", "–ü–æ–¥–ø–∏—Å–∫–∏, —á–ª–µ–Ω—Å—Ç–≤–∞"),
            ("‚ö°Ô∏è –î—Ä—É–≥–æ–µ", "expense", "–ü—Ä–æ—á–∏–µ —Ä–∞—Å—Ö–æ–¥—ã"),
            # –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ—Ö–æ–¥–æ–≤
            ("üíº –ó–∞—Ä–ø–ª–∞—Ç–∞", "income", "–û—Å–Ω–æ–≤–Ω–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞ –∏ –ø—Ä–µ–º–∏–∏"),
            ("üí∞ –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏", "income", "–î–æ—Ö–æ–¥ –æ—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π"),
            ("üéÅ –ü–æ–¥–∞—Ä–∫–∏", "income", "–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏ –∏ –ø—Ä–∏–∑—ã"),
            ("üíº –§—Ä–∏–ª–∞–Ω—Å", "income", "–î–æ—Ö–æ–¥ –æ—Ç –ø–æ–¥—Ä–∞–±–æ—Ç–∫–∏"),
            ("üè† –ê—Ä–µ–Ω–¥–∞", "income", "–î–æ—Ö–æ–¥ –æ—Ç —Å–¥–∞—á–∏ –≤ –∞—Ä–µ–Ω–¥—É"),
            ("‚ö°Ô∏è –î—Ä—É–≥–æ–µ", "income", "–ü—Ä–æ—á–∏–µ –¥–æ—Ö–æ–¥—ã")
        ]

        for name, type_, description in default_categories:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è
            existing_category = session.query(Category).filter_by(name=name, type=type_).first()
            if not existing_category:
                category = Category(
                    name=name,
                    type=type_,
                    icon=name.split()[0],  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —ç–º–æ–¥–∑–∏ –∫–∞–∫ –∏–∫–æ–Ω–∫—É
                    is_default=True
                )
                session.add(category)
        
        session.commit()
        logger.info("–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã")
        return True
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π: {e}")
        session.rollback()
        return False
