# üìä –¢–ò–ñ–ù–ï–í–ò–ô –ü–ï–†–Ü–û–î - –û–°–¢–ê–ù–ù–Ü 7 –î–ù–Ü–í –ó–ê–í–ï–†–®–ï–ù–û

## üìã –ó–∞–≤–¥–∞–Ω–Ω—è

–ó–º—ñ–Ω–∏—Ç–∏ –ª–æ–≥—ñ–∫—É —Ç–∏–∂–Ω–µ–≤–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É —É —Å—Ç–æ–≤–ø—á–∞—Å—Ç–∏—Ö —Ç–∞ –∫—Ä—É–≥–æ–≤–∏—Ö –¥—ñ–∞–≥—Ä–∞–º–∞—Ö: –∑–∞–º—ñ—Å—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω–æ–≥–æ —Ç–∏–∂–Ω—è (–ø–æ–Ω–µ–¥—ñ–ª–æ–∫-–Ω–µ–¥—ñ–ª—è) –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ **–æ—Å—Ç–∞–Ω–Ω—ñ 7 –¥–Ω—ñ–≤ –≤–∫–ª—é—á–∞—é—á–∏ —Å—å–æ–≥–æ–¥–Ω—ñ**.

## ‚úÖ –í–∏–∫–æ–Ω–∞–Ω—ñ –∑–º—ñ–Ω–∏

### 1. üìä –§—É–Ω–∫—Ü—ñ—è `create_bar_chart`

**–§–∞–π–ª:** `handlers/analytics_handler.py`

**–©–æ –∑–º—ñ–Ω–µ–Ω–æ:**

- –õ–æ–≥—ñ–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–ª—é—á—ñ–≤ –¥–ª—è —Ç–∏–∂–Ω–µ–≤–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É
- –ü–æ—Ä—è–¥–æ–∫ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–Ω—ñ–≤: –≤—ñ–¥ –Ω–∞–π—Å—Ç–∞—Ä—à–æ–≥–æ –¥–æ –Ω–∞–π–Ω–æ–≤—ñ—à–æ–≥–æ
- –ü—ñ–¥–ø–∏—Å–∏: "–°—å–æ–≥–æ–¥–Ω—ñ", "–í—á–æ—Ä–∞", "–î–µ–Ω—å —Ç–∏–∂–Ω—è (–¥–¥.–º–º)"

**–ö–æ–¥ –ø—ñ—Å–ª—è –∑–º—ñ–Ω:**

```python
elif period == "week":
    # –î–ª—è —Ç–∏–∂–Ω—è –ø–æ–∫–∞–∑—É—î–º–æ –æ—Å—Ç–∞–Ω–Ω—ñ 7 –¥–Ω—ñ–≤ –≤–∫–ª—é—á–∞—é—á–∏ —Å—å–æ–≥–æ–¥–Ω—ñ
    from datetime import datetime, timedelta
    now = datetime.now()
    transaction_date = transaction.transaction_date
    days_ago = (now.date() - transaction_date.date()).days

    if days_ago == 0:
        key = f"–°—å–æ–≥–æ–¥–Ω—ñ ({transaction_date.strftime('%d.%m')})"
    elif days_ago == 1:
        key = f"–í—á–æ—Ä–∞ ({transaction_date.strftime('%d.%m')})"
    else:
        weekdays = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–ù–¥']
        weekday_name = weekdays[transaction_date.weekday()]
        key = f"{weekday_name} ({transaction_date.strftime('%d.%m')})"
```

**–°—Ç–≤–æ—Ä–µ–Ω–Ω—è all_keys:**

```python
elif period == "week":
    # –î–ª—è —Ç–∏–∂–Ω—è —Å—Ç–≤–æ—Ä—é—î–º–æ –∫–ª—é—á—ñ –¥–ª—è –æ—Å—Ç–∞–Ω–Ω—ñ—Ö 7 –¥–Ω—ñ–≤
    from datetime import datetime, timedelta
    now = datetime.now()
    all_keys = []

    for i in range(6, -1, -1):  # –≤—ñ–¥ 6 –¥–Ω—ñ–≤ —Ç–æ–º—É –¥–æ —Å—å–æ–≥–æ–¥–Ω—ñ
        date = now - timedelta(days=i)
        if i == 0:
            key = f"–°—å–æ–≥–æ–¥–Ω—ñ ({date.strftime('%d.%m')})"
        elif i == 1:
            key = f"–í—á–æ—Ä–∞ ({date.strftime('%d.%m')})"
        else:
            weekdays = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–ù–¥']
            weekday_name = weekdays[date.weekday()]
            key = f"{weekday_name} ({date.strftime('%d.%m')})"
        all_keys.append(key)
```

### 2. üìÖ –§—É–Ω–∫—Ü—ñ—è `generate_simple_chart`

**–§–∞–π–ª:** `handlers/analytics_handler.py`

**–©–æ –∑–º—ñ–Ω–µ–Ω–æ:**

- –î—ñ–∞–ø–∞–∑–æ–Ω –¥–∞—Ç –¥–ª—è —Ç–∏–∂–Ω–µ–≤–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É
- –ù–∞–∑–≤–∞ –ø–µ—Ä—ñ–æ–¥—É: "–û—Å—Ç–∞–Ω–Ω—ñ 7 –¥–Ω—ñ–≤"

**–ö–æ–¥:**

```python
elif period == "week":
    start_date = (now - timedelta(days=6)).replace(hour=0, minute=0, second=0, microsecond=0)
    period_name = "–û—Å—Ç–∞–Ω–Ω—ñ 7 –¥–Ω—ñ–≤"
```

### 3. üîç –Ü–Ω—à—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏

**–û–Ω–æ–≤–ª–µ–Ω–æ –ª–æ–≥—ñ–∫—É —É —Ñ—É–Ω–∫—Ü—ñ—è—Ö:**

- `show_expense_statistics`
- `show_detailed_categories`
- `show_top_transactions`
- `show_ai_analysis_for_period`
- `show_period_comparison_detail`

**–í—Å—é–¥–∏ –∑–∞–º—ñ–Ω–µ–Ω–æ:**

```python
# –ë–£–õ–û:
if period_type == "week":
    start_date = now - timedelta(days=7)
    period_name = "—Ç–∏–∂–¥–µ–Ω—å"

# –°–¢–ê–õ–û:
if period_type == "week":
    start_date = (now - timedelta(days=6)).replace(hour=0, minute=0, second=0, microsecond=0)
    period_name = "7 –¥–Ω—ñ–≤"
```

### 4. üîÑ –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ø–µ—Ä—ñ–æ–¥—ñ–≤

**–û—Å–æ–±–ª–∏–≤–∞ –ª–æ–≥—ñ–∫–∞ –¥–ª—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è —Ç–∏–∂–Ω—ñ–≤:**

```python
if period_type == "week":
    # –ü–æ—Ç–æ—á–Ω–∏–π —Ç–∏–∂–¥–µ–Ω—å - –æ—Å—Ç–∞–Ω–Ω—ñ 7 –¥–Ω—ñ–≤
    current_start = (now - timedelta(days=6)).replace(hour=0, minute=0, second=0, microsecond=0)
    current_end = now
    # –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ç–∏–∂–¥–µ–Ω—å - 7 –¥–Ω—ñ–≤ –ø–µ—Ä–µ–¥ –ø–æ—Ç–æ—á–Ω–∏–º
    prev_start = (now - timedelta(days=13)).replace(hour=0, minute=0, second=0, microsecond=0)
    prev_end = (now - timedelta(days=7)).replace(hour=23, minute=59, second=59, microsecond=999999)
    period_name = "7 –¥–Ω—ñ–≤"
```

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### 1. –¢–µ—Å—Ç –ª–æ–≥—ñ–∫–∏ (`test_week_logic_simple.py`)

```
‚úÖ –ü–æ–∫–∞–∑—É—é—Ç—å—Å—è –æ—Å—Ç–∞–Ω–Ω—ñ 7 –¥–Ω—ñ–≤ (–≤–∫–ª—é—á–∞—é—á–∏ —Å—å–æ–≥–æ–¥–Ω—ñ)
‚úÖ –°—å–æ–≥–æ–¥–Ω—ñ —Ç–∞ –≤—á–æ—Ä–∞ –º–∞—é—Ç—å —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –ø–æ–∑–Ω–∞—á–∫–∏
‚úÖ –Ü–Ω—à—ñ –¥–Ω—ñ –ø–æ–∫–∞–∑—É—é—Ç—å –¥–µ–Ω—å —Ç–∏–∂–Ω—è + –¥–∞—Ç—É
‚úÖ –ü–æ—Ä—è–¥–æ–∫ –≤—ñ–¥ –Ω–∞–π—Å—Ç–∞—Ä—à–æ–≥–æ –¥–æ –Ω–∞–π–Ω–æ–≤—ñ—à–æ–≥–æ –¥–Ω—è
‚úÖ –î—ñ–∞–ø–∞–∑–æ–Ω –¥–∞—Ç –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –ø—Ä–∞–≤–∏–ª—å–Ω–æ
```

### 2. –¢–µ—Å—Ç —Å—Ç–æ–≤–ø—á–∞—Å—Ç–æ–≥–æ –≥—Ä–∞—Ñ—ñ–∫—É (`test_week_bar_chart.py`)

```
‚úÖ –õ–æ–≥—ñ–∫–∞ –æ—Å—Ç–∞–Ω–Ω—ñ—Ö 7 –¥–Ω—ñ–≤ –ø—Ä–∞—Ü—é—î –ø—Ä–∞–≤–∏–ª—å–Ω–æ
‚úÖ –ö–ª—é—á—ñ —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è —É –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É
‚úÖ –°—å–æ–≥–æ–¥–Ω—ñ —Ç–∞ –≤—á–æ—Ä–∞ –ø–æ–∑–Ω–∞—á–µ–Ω—ñ –æ–∫—Ä–µ–º–æ
‚úÖ –Ü–Ω—à—ñ –¥–Ω—ñ –º–∞—é—Ç—å –¥–µ–Ω—å —Ç–∏–∂–Ω—è + –¥–∞—Ç—É
‚úÖ –ì—Ä–∞—Ñ—ñ–∫ —Å—Ç–≤–æ—Ä–µ–Ω–æ –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º–∏ –ø—ñ–¥–ø–∏—Å–∞–º–∏
```

**–ü—Ä–∏–∫–ª–∞–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É:**

```
–°—Ä (18.06): –î–æ—Ö–æ–¥–∏ 2,700 –≥—Ä–Ω, –í–∏—Ç—Ä–∞—Ç–∏ 900 –≥—Ä–Ω
–ß—Ç (19.06): –î–æ—Ö–æ–¥–∏ 0 –≥—Ä–Ω, –í–∏—Ç—Ä–∞—Ç–∏ 800 –≥—Ä–Ω
–ü—Ç (20.06): –î–æ—Ö–æ–¥–∏ 2,300 –≥—Ä–Ω, –í–∏—Ç—Ä–∞—Ç–∏ 700 –≥—Ä–Ω
–°–± (21.06): –î–æ—Ö–æ–¥–∏ 0 –≥—Ä–Ω, –í–∏—Ç—Ä–∞—Ç–∏ 600 –≥—Ä–Ω
–ù–¥ (22.06): –î–æ—Ö–æ–¥–∏ 1,900 –≥—Ä–Ω, –í–∏—Ç—Ä–∞—Ç–∏ 500 –≥—Ä–Ω
–í—á–æ—Ä–∞ (23.06): –î–æ—Ö–æ–¥–∏ 0 –≥—Ä–Ω, –í–∏—Ç—Ä–∞—Ç–∏ 400 –≥—Ä–Ω
–°—å–æ–≥–æ–¥–Ω—ñ (24.06): –î–æ—Ö–æ–¥–∏ 1,500 –≥—Ä–Ω, –í–∏—Ç—Ä–∞—Ç–∏ 300 –≥—Ä–Ω
```

## üìà –ü–µ—Ä–µ–≤–∞–≥–∏ –Ω–æ–≤–æ—ó –ª–æ–≥—ñ–∫–∏

### üéØ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏–π –¥–æ—Å–≤—ñ–¥

1. **–Ü–Ω—Ç—É—ó—Ç–∏–≤–Ω—ñ—Å—Ç—å** - "—Ç–∏–∂–¥–µ–Ω—å" —Ç–µ–ø–µ—Ä –æ–∑–Ω–∞—á–∞—î "–æ—Å—Ç–∞–Ω–Ω—ñ 7 –¥–Ω—ñ–≤"
2. **–ê–∫—Ç—É–∞–ª—å–Ω—ñ—Å—Ç—å** - –∑–∞–≤–∂–¥–∏ –≤–∫–ª—é—á–∞—î —Å—å–æ–≥–æ–¥–Ω—ñ—à–Ω—ñ –¥–∞–Ω—ñ
3. **–ó—Ä–æ–∑—É–º—ñ–ª—ñ—Å—Ç—å** - —á—ñ—Ç–∫—ñ –ø—ñ–¥–ø–∏—Å–∏ –∑ –¥–∞—Ç–∞–º–∏

### üìä –ê–Ω–∞–ª—ñ—Ç–∏—á–Ω–∞ —Ü—ñ–Ω–Ω—ñ—Å—Ç—å

1. **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å** - –∑–∞–≤–∂–¥–∏ 7 –¥–Ω—ñ–≤ –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –¥–Ω—è —Ç–∏–∂–Ω—è
2. **–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—ñ—Å—Ç—å** - –ª–µ–≥–∫–æ –ø–æ—Ä—ñ–≤–Ω—é–≤–∞—Ç–∏ —Ä—ñ–∑–Ω—ñ 7-–¥–µ–Ω–Ω—ñ –ø–µ—Ä—ñ–æ–¥–∏
3. **–ê–∫—Ç—É–∞–ª—å–Ω—ñ—Å—Ç—å** - –Ω–µ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω–∏—Ö —Ç–∏–∂–Ω—ñ–≤

### üíª –¢–µ—Ö–Ω—ñ—á–Ω–∞ —è–∫—ñ—Å—Ç—å

1. **–£–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∞ –ª–æ–≥—ñ–∫–∞** - –≤—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –æ–¥–Ω–∞–∫–æ–≤—É –ª–æ–≥—ñ–∫—É
2. **–ü—Ä–∞–≤–∏–ª—å–Ω–∏–π –¥—ñ–∞–ø–∞–∑–æ–Ω** - —Ç–æ—á–Ω–æ 7 –¥–Ω—ñ–≤ –≤–∫–ª—é—á–∞—é—á–∏ —Å—å–æ–≥–æ–¥–Ω—ñ
3. **–ö–æ—Ä–µ–∫—Ç–Ω–µ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è** - –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ç–∏–∂–¥–µ–Ω—å —Ç–∞–∫–æ–∂ 7 –¥–Ω—ñ–≤

## ‚úÖ –°—Ç–∞—Ç—É—Å: –ó–ê–í–ï–†–®–ï–ù–û

–í—Å—ñ –∑–º—ñ–Ω–∏ –≤–Ω–µ—Å–µ–Ω–æ —Ç–∞ –ø—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ. –¢–µ–ø–µ—Ä —Ç–∏–∂–Ω–µ–≤–∏–π –ø–µ—Ä—ñ–æ–¥ —É –≤—Å—ñ—Ö –¥—ñ–∞–≥—Ä–∞–º–∞—Ö —Ç–∞ –∞–Ω–∞–ª—ñ—Ç–∏—Ü—ñ –ø–æ–∫–∞–∑—É—î **–æ—Å—Ç–∞–Ω–Ω—ñ 7 –¥–Ω—ñ–≤ –≤–∫–ª—é—á–∞—é—á–∏ —Å—å–æ–≥–æ–¥–Ω—ñ** –∑–∞–º—ñ—Å—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω–æ–≥–æ —Ç–∏–∂–Ω—è.

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è:** 24 —á–µ—Ä–≤–Ω—è 2025
**–§–∞–π–ª–∏ –∑–º—ñ–Ω–µ–Ω–æ:** `handlers/analytics_handler.py`
**–¢–µ—Å—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω–æ:** `test_week_logic_simple.py`, `test_week_bar_chart.py`
